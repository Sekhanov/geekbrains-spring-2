<?xml version="1.0" encoding="UTF-8" ?>
<flow xmlns="http://www.springframework.org/schema/webflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd">
    
    <var name="authenticationUserData" class="com.skhanov.geekbrainsspring.flows.AuthenticationUserData" /> 
    <var name="personalUserData" class="com.skhanov.geekbrainsspring.flows.PersonalUserData" /> 
        
    <on-start>
        <evaluate expression="registerFlowHandler.init()" result="flowScope.registrationModel"></evaluate>
    </on-start>
    
    <view-state id="register1" view="flows/register/register1" model="authenticationUserData">
        <transition on="validateRegister1" to="validateRegister1"></transition>
        <on-exit>
            <evaluate expression="registerFlowHandler.addAuthUserInfo(flowScope.registrationModel, authenticationUserData)"></evaluate>
        </on-exit>
    </view-state>  

    <action-state id="validateRegister1">
        <evaluate expression="registerFlowHandler.validateAuthUserInfo(authenticationUserData, messageContext)"></evaluate>
        <transition on="success" to="register2"></transition>
        <transition on="failure" to="register1"></transition>
    </action-state>

    <view-state id="register2" view="flows/register/register2" model="personalUserData">
        <transition on="validateRegister2" to!!!></transition>
    </view-state>

    
</flow>